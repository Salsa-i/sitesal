<!DOCTYPE html>
<html>
<head>
  <title>Meu Site - Início</title>
  <link rel="stylesheet" href="style.css"> 
</head>
<body>
  <div id="progress-bar"></div>
  
  <h1>Bem-vindo ao meu site!</h1>
  <p>Aqui você vai encontrar minhas escritas e pensamentos.</p>
  
  <nav>
    <a href="sobre.html">Sobre</a>
    <a href="textos/capitulo1.html">Capítulo 1</a>
  </nav>

  <p>
    Esse é o site
  </p>

  <section id="contato-rapido">
    <h2>Me Envie Uma Mensagem!</h2>
    <form action="https://formspree.io/f/myznwabl" method="POST">
      
      <label for="email">Seu Email:</label>
      <input type="email" id="email" name="_replyto" required placeholder="seuemail@exemplo.com">
      
      <label for="mensagem">o que precisa?:</label>
      <textarea id="mensagem" name="mensagem" required placeholder="Digite sua mensagem aqui..."></textarea>
      
      <button type="submit">Envia ai</button>
      <p class="aviso-form">Obrigado!</p>
    </form>
    <div id="status"></div>
  </section>
 <script>
    // 1. Script da Barra de Progresso (Mantido)
    const progressBar = document.getElementById('progress-bar');
    window.addEventListener('scroll', () => {
      const totalHeight = document.body.scrollHeight - window.innerHeight;
      const scrollPosition = window.scrollY;
      const progress = (scrollPosition / totalHeight) * 100;
      progressBar.style.width = `${progress}%`;
    });

    // 2. Script de Envio do Formulário (Otimizado)
    
    // Seleciona o formulário diretamente usando a tag <form>
    var form = document.getElementsByTagName("form")[0]; 
    var status = document.getElementById("status");

    function success() {
      form.reset(); // Limpa o formulário
      status.innerHTML = "Obrigado! Mensagem enviada com sucesso.";
      status.style.color = '#00CC99'; // Cor de sucesso (verde/ciano)
      // Remove a mensagem após 5 segundos
      setTimeout(() => status.innerHTML = '', 5000); 
    }

    function error() {
      status.innerHTML = "Oops! Ocorreu um erro. Tente novamente.";
      status.style.color = '#e73c7e'; // Cor de erro (rosa)
    }

    form.addEventListener("submit", function(ev) {
      ev.preventDefault(); // Impede o envio padrão e o redirecionamento
      var data = new FormData(form);
      fetch(form.action, {
        method: form.method,
        body: data,
        headers: {
            'Accept': 'application/json'
        }
      }).then(response => {
        if (response.ok) {
          success();
        } else {
          response.json().then(data => {
            if (Object.hasOwn(data, 'errors')) {
              status.innerHTML = data["errors"].map(error => error["message"]).join(", ")
            } else {
              error();
            }
          })
        }
      }).catch(error => {
        error()
      });
    });
  </script>
</body>
</html>