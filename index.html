<!DOCTYPE html>
<html>
<head>
  <title>Meu Site - Início</title>
  <link rel="stylesheet" href="style.css">
  <script src="theme.js"></script>
</head>
<body>
  <div id="progress-bar"></div>
  <div id="sun"></div>
  
  <h1>Bem-vindo ao meu site!</h1>
  <p>Aqui você vai encontrar minhas escritas e pensamentos.</p>
  
  <nav>
    <a href="sobre.html">Sobre</a>
    <a href="textos/capitulo1.html">Capítulo 1</a>
  </nav>

  <p>
    Esse é o site
  </p>

  <section id="contato-rapido">
    <h2>Diga:</h2>
    <form action="https://formspree.io/f/myznwabl" method="POST">
      
      <label for="email">Seu Email:</label>
      <input type="email" id="email" name="_replyto" required placeholder="">
      
      <label for="mensagem">o que precisa?:</label>
      <textarea id="mensagem" name="mensagem" required placeholder=""></textarea>
      
      <button type="submit">Envie</button>
      <p class="aviso-form">Logo menos respondo, volte amanhã!</p>
    </form>
    <div id="status"></div>
  </section>
 <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      
      // --- 1. SCRIPT DA BARRA DE PROGRESSO ---
      const progressBar = document.getElementById('progress-bar');
      if (progressBar) { // Verifica se a barra existe
        window.addEventListener('scroll', () => {
          const totalHeight = document.body.scrollHeight - window.innerHeight;
          const scrollPosition = window.scrollY;
          // Evita divisão por zero
          const progress = totalHeight > 0 ? (scrollPosition / totalHeight) * 100 : 0; 
          progressBar.style.width = `${progress}%`;
        });
      }


      // --- 2. SCRIPT DE ENVIO DO FORMULÁRIO ---
      // Seleciona o primeiro formulário do documento
      var form = document.getElementsByTagName("form")[0]; 
      var status = document.getElementById("status");

      // Só tenta anexar o listener se o formulário e o status existirem
      if (form && status) { 
        function success() {
          form.reset(); 
          status.innerHTML = "Obrigado! Mensagem enviada com sucesso.";
          status.style.color = '#00CC99';
          setTimeout(() => status.innerHTML = '', 5000); 
        }

        function error() {
          status.innerHTML = "Oops! Ocorreu um erro. Tente novamente.";
          status.style.color = '#e73c7e';
        }

        form.addEventListener("submit", function(ev) {
          ev.preventDefault();
          var data = new FormData(form);
          fetch(form.action, {
            method: form.method,
            body: data,
            headers: {
                'Accept': 'application/json'
            }
          }).then(response => {
            if (response.ok) {
              success();
            } else {
              response.json().then(data => {
                if (Object.hasOwn(data, 'errors')) {
                  status.innerHTML = data["errors"].map(error => error["message"]).join(", ")
                } else {
                  error();
                }
              })
            }
          }).catch(error => {
            error()
          });
        });
      }
    }); // Fim do DOMContentLoaded
  </script>
</body>
</html>